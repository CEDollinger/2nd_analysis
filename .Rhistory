resample(., helper.files[["grte"]][["ru"]])
helper.files[["grte"]][["species"]] <- dbConnect(RSQLite::SQLite(),  dbname = "../project2ndStudy/projectTest_grte/database/species_grte.sqlite") %>%
tbl(., "species") %>% collect() %>% dplyr::select(shortName, lightResponseClass, isConiferous, sapHDSapling, psiMin) %>%
rename(species = shortName) %>% mutate(lightResponseClass = as.numeric(lightResponseClass)) %>%
mutate(species.code = as.numeric(as.factor(species))) %>%
filter(species %ni% c("Potr_backup", "Pial_backup_org", "Pico_backup")) %>%
mutate(species.code = ifelse(species %in% common.species$grte, species.code, 0))
helper.files[["grte"]][["env"]] <- read_delim("../project2ndStudy/projectTest_grte/gis/environment_file_cluster_kbdi_downscaledclimate.txt")
helper.files[["stoko"]][["ru"]] <- rast("../project2ndStudy/projectTest_stoko/gis/resourceUnit_snp_220908.asc")
helper.files[["stoko"]][["stand"]] <- rast("../project2ndStudy/projectTest_stoko/gis/standgrid_speed.asc")
helper.files[["stoko"]][["elev"]] <- rast("../project2ndStudy/projectTest_stoko/gis/jpn_elv_clipClim_JGD2000Zone13_res100m_cropped.asc") %>%
resample(., helper.files[["stoko"]][["ru"]])
helper.files[["stoko"]][["species"]] <- dbConnect(RSQLite::SQLite(),  dbname = "../project2ndStudy/projectTest_stoko/database/species_stoko.sqlite") %>%
tbl(., "speciesParameters") %>% collect() %>% dplyr::select(shortName, lightResponseClass, isConiferous, sapHDSapling, psiMin) %>%
rename(species = shortName) %>% mutate(lightResponseClass = as.numeric(lightResponseClass)) %>%
mutate(species.code = as.numeric(as.factor(species))) %>%
mutate(species.code = ifelse(species %in% common.species$stoko, species.code, 0))
helper.files[["stoko"]][["env"]] <- read_delim("../project2ndStudy/projectTest_stoko/gis/environment_final.txt")
rid.df <- data.frame()
for (landscape in 1:3) {
rid_i <-helper.files[[landscapes[landscape]]][["ru"]] %>%
terra::as.data.frame(., xy=T) %>% rename(rid=3) %>%
drop_na() %>% mutate(landscape = landscapes[landscape])
rid.df <- bind_rows(rid.df, rid_i);rm(rid_i)
}
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
landscapename <- "bgd"
# all possible simulation runs (for now)
sims <- expand_grid(climate=c("baseline", "hotdry"), rep=c("1"),
sizeMods=c("1", "2", "5", "10"), freqMods=c("1", "2", "5", "10"),
browsingMods=c("1", "2", "5", "10"), fecundityMods= c("100", "50", "20", "10")); sims$dbname <-
paste0("output_", landscapename, "_", sims$climate, "_rep", sims$rep, "_size", sims$sizeMods,
"_freq", sims$freqMods, "_browsing", sims$browsingMods, "_fecundity", sims$fecundityMods, ".sqlite"); sims
ist <- data.frame(dbname=dir(paste0("../project2ndStudy/projectTest_", landscapename, "/output/"), pattern = "browsing"))
# identify which simulations are missing
missing <- anti_join(sims, ist)
ls <- readRDS(paste0("results/datasets/ls_", landscapename, "_raw.RDATA"))
ds <- readRDS(paste0("results/datasets/ds_", landscapename, "_raw.RDATA"))
rem <- readRDS(paste0("results/datasets/rem_", landscapename, "_raw.RDATA"))
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
## patch output ####
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
landscapename <- "bgd"
getwd()
# mean simulated patch size per agent from 2021-2100 under reference climate
patch.lib <- readRDS(paste0("../prep/data/patch.lib_", landscapename,".RDATA"))
rm(patch.lib)
# mean simulated patch size per agent from 2021-2100 under reference climate
patch.lib <- readRDS(paste0("../prep/data/patch.lib_", landscapename,".RDATA"))
agent.mean <- patch.lib[["baseline_wet_warm"]] %>% # all patches under reference climate for that landscape
filter(year < 81, # only patches from 2021-2100
genesis == "simulated") %>%
distinct() %>%
group_by(agent) %>%
summarise(mean_size=mean(size), # mean patch size per agent between 2021-2100
events = round(sum(n())/20), # mean total number of events per agent between 2021-2100
sev_basal_sd = sd(sev_basal),
sev_basal_mean = mean(sev_basal),
sev_basal_median = median(sev_basal)) %>% ungroup() %>%
mutate(landscape = landscapename)
library(beepr)
beep(0)
View(agent.mean)
agent.mean <- patch.lib[["baseline_wet_warm"]] %>% # all patches under reference climate for that landscape
filter(year < 81, # only patches from 2021-2100
genesis == "simulated") %>%
distinct() %>%
group_by(agent) %>%
summarise(mean_size=mean(size), # mean patch size per agent between 2021-2100
events = round(sum(n())/20)) %>% ungroup() %>% # mean total number of events per agent between 2021-2100
mutate(landscape = landscapename)
View(agent.mean)
rm(patch.lib)
ref.df <- data.frame()
ref.df <- bind_rows(ref.df, agent.mean)
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
## patch output ####
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
landscapename <- "stoko"
# mean simulated patch size per agent from 2021-2100 under reference climate
patch.lib <- readRDS(paste0("../prep/data/patch.lib_", landscapename,".RDATA"))
agent.mean <- patch.lib[["baseline_wet_warm"]] %>% # all patches under reference climate for that landscape
filter(year < 81, # only patches from 2021-2100
genesis == "simulated") %>%
distinct() %>%
group_by(agent) %>%
summarise(mean_size=mean(size), # mean patch size per agent between 2021-2100
events = round(sum(n())/20)) %>% ungroup() %>% # mean total number of events per agent between 2021-2100
mutate(landscape = landscapename)
(agent.mean <- patch.lib[["baseline_wet_warm"]] %>% # all patches under reference climate for that landscape
filter(year < 81, # only patches from 2021-2100
genesis == "simulated") %>%
distinct() %>%
group_by(agent) %>%
summarise(mean_size=mean(size), # mean patch size per agent between 2021-2100
events = round(sum(n())/20)) %>% ungroup() %>% # mean total number of events per agent between 2021-2100
mutate(landscape = landscapename))
rm(patch.lib)
ref.df <- bind_rows(ref.df, agent.mean)
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
## patch output ####
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
landscapename <- "grte"
# mean simulated patch size per agent from 2021-2100 under reference climate
patch.lib <- readRDS(paste0("../prep/data/patch.lib_", landscapename,".RDATA"))
(agent.mean <- patch.lib[["baseline_wet_warm"]] %>% # all patches under reference climate for that landscape
filter(year < 81, # only patches from 2021-2100
genesis == "simulated") %>%
distinct() %>%
group_by(agent) %>%
summarise(mean_size=mean(size), # mean patch size per agent between 2021-2100
events = round(sum(n())/20)) %>% ungroup() %>% # mean total number of events per agent between 2021-2100
mutate(landscape = landscapename))
(agent.mean <- patch.lib[["baseline_wet_warm"]] %>% # all patches under reference climate for that landscape
filter(year < 81, # only patches from 2021-2100
genesis == "simulated") %>%
distinct() %>%
group_by(agent) %>%
summarise(mean_size=mean(size), # mean patch size per agent between 2021-2100
events = round(sum(n())/20)) %>% ungroup() %>% # mean total number of events per agent between 2021-2100
mutate(landscape = landscapename,
events = ifelse(agent == "bite", events/20, events),
mean_size = ifelse(agent == "bite", mean_size*20, mean_size)))
ref.df <- bind_rows(ref.df, agent.mean)
View(ref.df)
write_csv(ref.df, "helper_files/ref.df.csv")
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
## patch output ####
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
ref.df <- read_csv("helper_files/ref.df.csv")
View(ist)
patchOutputs <- expand_grid(sizeMod=c(1,2,5,10), freqMod=c(1,2,5,10), browsingMod=c(1,2,5,10),
fecundityMod=c(100,50,20,10), climate=c("baseline", "hotdry"))
View(sims)
paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output")
landscapename<-"bgd"
paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output")
sims$climate
i<-1
paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i])
read_csv(paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv"))
read_delim(paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv"))
read_delim(paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")) %>%
mutate(landscape=landscapename,
climate=sims$climate[i], rep=sims$rep[i], size=sims$sizeMods[i], freq=sims$freqMods[i],
browsing=sims$browsingMods[i], fecundity=sims$fecundityMods[i])
patch_i <- read_delim(paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")) %>%
mutate(landscape=landscapename,
climate=sims$climate[i], rep=sims$rep[i], size=sims$sizeMods[i], freq=sims$freqMods[i],
browsing=sims$browsingMods[i], fecundity=sims$fecundityMods[i])
summary(patch_i)
patch_i %>% filter(before_ba==0)
patch_i <- read_delim(paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")) %>%
mutate(landscape=landscapename,
climate=sims$climate[i], rep=sims$rep[i], size=sims$sizeMods[i], freq=sims$freqMods[i],
browsing=sims$browsingMods[i], fecundity=sims$fecundityMods[i])
patch_i %>% filter(before_ba==0)
patch_i %>% filter(killed_ba==0)
patch_i <- read_delim(paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")) %>%
mutate(landscape=landscapename,
climate=sims$climate[i], rep=sims$rep[i], size=sims$sizeMods[i], freq=sims$freqMods[i],
browsing=sims$browsingMods[i], fecundity=sims$fecundityMods[i],
n_cells = ifelse(killed_ba == 0, 0, n_cells)) %>%
filter(n_cells > 0)
summary(patch_i)
# requirment for the management intervention to count as a disturbance patch:
## needs to be forested (before_ba > 0, n_cells > 0)
## trees need to have been killed (killed_ba > 0)
patch.df <- data.frame()
for (i in 1:nrow(sims)) {
patch.df <- bind_rows(patch.df,
read_delim(paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")) %>%
mutate(landscape=landscapename,
climate=sims$climate[i], rep=sims$rep[i], size=sims$sizeMods[i], freq=sims$freqMods[i],
browsing=sims$browsingMods[i], fecundity=sims$fecundityMods[i],
n_cells = ifelse(killed_ba == 0, 0, n_cells)) %>%
filter(n_cells > 0)
)
}
dbname <- paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")
file.exists(dbname)
i<-1
dbname <- paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")
file.exists(dbname)
read_delim(dbname)
# requirements for the management intervention to count as a disturbance patch:
## needs to be forested (before_ba > 0, n_cells > 0)
## trees need to have been killed (killed_ba > 0)
patch.df <- data.frame()
for (i in 1:nrow(sims)) {
dbname <- paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")
if (file.exists(dbname)) {
patch.df <- bind_rows(patch.df,
read_delim(dbname) %>%
mutate(landscape=landscapename,
climate=sims$climate[i], rep=sims$rep[i], size=sims$sizeMods[i], freq=sims$freqMods[i],
browsing=sims$browsingMods[i], fecundity=sims$fecundityMods[i],
n_cells = ifelse(killed_ba == 0, 0, n_cells)) %>%
filter(n_cells > 0)
)
}
}
i%%16==0
# requirements for the management intervention to count as a disturbance patch:
## needs to be forested (before_ba > 0, n_cells > 0)
## trees need to have been killed (killed_ba > 0)
patch.df <- data.frame()
for (i in 1:nrow(sims)) {
dbname <- paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")
if (file.exists(dbname)) {
patch.df <- bind_rows(patch.df,
read_delim(dbname) %>%
mutate(landscape=landscapename,
climate=sims$climate[i], rep=sims$rep[i], size=sims$sizeMods[i], freq=sims$freqMods[i],
browsing=sims$browsingMods[i], fecundity=sims$fecundityMods[i],
n_cells = ifelse(killed_ba == 0, 0, n_cells)) %>%
filter(n_cells > 0)
)
}
if (i%%16==0) print(paste0(round((i/nrow(sims)*100),1), " %: ", dbname))
}
# requirements for the management intervention to count as a disturbance patch:
## needs to be forested (before_ba > 0, n_cells > 0)
## trees need to have been killed (killed_ba > 0)
patch.df <- data.frame()
for (i in 1:nrow(sims)) {
dbname <- paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")
if (file.exists(dbname)) {
patch.df <- bind_rows(patch.df,
read_delim(dbname) %>%
mutate(landscape=landscapename,
climate=sims$climate[i], rep=sims$rep[i], size=sims$sizeMods[i], freq=sims$freqMods[i],
browsing=sims$browsingMods[i], fecundity=sims$fecundityMods[i],
n_cells = ifelse(killed_ba == 0, 0, n_cells)) %>%
filter(n_cells > 0)
)
if (i%%16==0) print(paste0(round((i/nrow(sims)*100),1), " %: ", dbname))
}
}
ref.df %>%
filter(landscape==landscapename)
ref.df %>%
filter(landscape==landscapename) %>%
full_join(patch.df)
patch_i %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity)
#   group_by(agent) %>%
#   summarise(mean_size=mean(size), # mean patch size per agent between 2021-2100
#             events = round(sum(n())/20)) %>% ungroup() %>% # mean total number of events per agent between 2021-2100
#   mutate(landscape = landscapename,
#          events = ifelse(agent == "bite", events/20, events),
#          mean_size = ifelse(agent == "bite", mean_size*20, mean_size)))
# rm(patch.lib)
#
# ref.df <- data.frame()
# ref.df <- bind_rows(ref.df, agent.mean)
ref.df %>% rename(size_expected = mean_size)
#   group_by(agent) %>%
#   summarise(mean_size=mean(size), # mean patch size per agent between 2021-2100
#             events = round(sum(n())/20)) %>% ungroup() %>% # mean total number of events per agent between 2021-2100
#   mutate(landscape = landscapename,
#          events = ifelse(agent == "bite", events/20, events),
#          mean_size = ifelse(agent == "bite", mean_size*20, mean_size)))
# rm(patch.lib)
#
# ref.df <- data.frame()
# ref.df <- bind_rows(ref.df, agent.mean)
ref.df %>% rename(size_expected = mean_size, events_expected=events)
#   group_by(agent) %>%
#   summarise(mean_size=mean(size), # mean patch size per agent between 2021-2100
#             events = round(sum(n())/20)) %>% ungroup() %>% # mean total number of events per agent between 2021-2100
#   mutate(landscape = landscapename,
#          events = ifelse(agent == "bite", events/20, events),
#          mean_size = ifelse(agent == "bite", mean_size*20, mean_size)))
# rm(patch.lib)
#
# ref.df <- data.frame()
# ref.df <- bind_rows(ref.df, agent.mean)
ref.df <- ref.df %>% rename(size_expected = mean_size, events_expected=events)
write_csv(ref.df, "helper_files/ref.df.csv")
View(ref.df)
patch_i %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity) %>%
summarise(size_actual = mean(n_cells)) %>%
ungroup()
patch_i %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells)) %>%
ungroup()
patch_i %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells), events_actual = n()) %>%
ungroup()
ref.df[ref.df$landscape==landscapename,]
patch_i %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells), events_actual = n()) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,])
patch_i %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells), events_actual = n()) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(rate_expected = size_expected * events_expected)
patch_i %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells), events_actual = n()) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(area_expected = size_expected * events_expected / 100)
patch_i %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells), events_actual = n()) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(area_expected = size_expected * events_expected/100,
area_expected = size_actual * events_actual/100)
patch_i %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells), events_actual = n()) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells), events_actual = n()) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100)
write_csv(patch.df, paste0("results/datasets/", landscapename, "patch.df.csv"))
write_csv(patch.df, paste0("results/datasets/patch.df_", landscapename, ".csv"))
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells), events_actual = n()) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_dff = (size_actual-size_expected)/size_expected)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells), events_actual = n()) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_dff = (area_actual-area_expected)/area_expected)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells)*size, events_actual = n()*freq) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells)*as.numeric(size), events_actual = n()*as.numeric(freq)) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells)*mean(as.numeric(size)),
events_actual = n()*mean(as.numeric(freq))) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected)
ref.df
ref.df[ref.df$landscape==landscapename,] %>%
mutate(size_expected=size_expected*mean(as.numeric(size))
ref.df[ref.df$landscape==landscapename,] %>%
ref.df[ref.df$landscape==landscapename,] %>%
mutate(size_expected=size_expected*mean(as.numeric(size)
ref.df[ref.df$landscape==landscapename,] %>%
ref.df[ref.df$landscape==landscapename,] %>%
mutate(size_expected=size_expected*mean(as.numeric(size)))
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()*mean(as.numeric(freq))) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(size_expected=size_expected*mean(as.numeric(size)),
area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()*mean(as.numeric(freq))) %>%
ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(size_expected=size_expected*mean(as.numeric(size)),
events_expected=events_expected*mean(as.numeric(freq)),
area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()) %>% ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(size_expected = size_expected * mean(as.numeric(size)),
events_expected = events_expected * mean(as.numeric(freq)),
area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected)
i<-1; patch.df <- data.frame()
for (i in 1:nrow(sims)) {
dbname <- paste0("../project2ndStudy/projectTest_", landscapename, "/output/patch_output/output_patches_",
landscapename, "_", sims$climate[i], "_rep", sims$rep[i], "_size", sims$sizeMods[i],
"_freq", sims$freqMods[i], "_browsing", sims$browsingMods[i], "_fecundity", sims$fecundityMods[i], ".csv")
if (file.exists(dbname)) {
patch.df <- bind_rows(patch.df,
read_delim(dbname) %>%
mutate(landscape=landscapename,
climate=sims$climate[i], rep=sims$rep[i], size=sims$sizeMods[i], freq=sims$freqMods[i],
browsing=sims$browsingMods[i], fecundity=sims$fecundityMods[i],
n_cells = ifelse(killed_ba == 0, 0, n_cells)) %>%
filter(n_cells > 0)
)
}
if (i%%16==0) print(paste0(round((i/nrow(sims)*100),1), " %: ", dbname))
}; write_csv(patch.df, paste0("results/datasets/patch.df_", landscapename, ".csv"))
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()) %>% ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(size_expected = size_expected * mean(as.numeric(size)),
events_expected = events_expected * mean(as.numeric(freq)),
area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()) %>% ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(events_expected = events_expected * mean(as.numeric(freq)),
area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()) %>% ungroup()
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()) %>% ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,])
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()) %>% ungroup() %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(events_expected = events_expected * mean(as.numeric(freq)))
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()) %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(size_expected = size_expected * mean(as.numeric(size)),
events_expected = events_expected * mean(as.numeric(freq)),
area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected)
patch.df %>%
group_by(landscape, climate, rep, size, freq, browsing, fecundity, agent) %>%
summarise(size_actual = mean(n_cells),
events_actual = n()) %>%
full_join(ref.df[ref.df$landscape==landscapename,]) %>%
mutate(size_expected = size_expected * mean(as.numeric(size)),
events_expected = events_expected * mean(as.numeric(freq)),
area_expected = size_expected * events_expected/100,
area_actual = size_actual * events_actual/100,
area_diff = (area_actual-area_expected)/area_expected) %>%
summary()
