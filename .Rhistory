#     pull(species))
common.stoko <- c("beer", "absa", "acmo", "kase", "qumo", "alhi", "tacu", "soco")
common.species <- list(common.bgd, common.grte, common.stoko); names(common.species) <- landscapes; rm(common.bgd, common.grte, common.stoko)
helpers <- list(list(), list(), list(), tibble(), tibble()); names(helpers) <- c("ru", "stand", "elev", "species", "env")
helper.files <- list(helpers, helpers, helpers); names(helper.files) <- landscapes; rm(helpers)
helper.files[["bgd"]][["ru"]] <- rast("../project2ndStudy/projectTest_bgd/gis/objectid.asc")
helper.files[["bgd"]][["stand"]] <- rast("../project2ndStudy/projectTest_bgd/gis/standgrid.asc")
helper.files[["bgd"]][["elev"]] <- rast("../project2ndStudy/projectTest_bgd/gis/dem100_rid.asc") %>%
resample(., helper.files[["bgd"]][["ru"]])
helper.files[["bgd"]][["species"]] <- dbConnect(RSQLite::SQLite(),  dbname = "../project2ndStudy/projectTest_bgd/database/species_bgd.sqlite") %>%
tbl(., "species") %>% collect() %>% dplyr::select(shortName, lightResponseClass, isConiferous, sapHDSapling, psiMin, displayColor) %>%
rename(species = shortName) %>% mutate(lightResponseClass = as.numeric(lightResponseClass)) %>%
mutate(species.code = as.numeric(as.factor(species))) %>%
mutate(species.code = ifelse(species %in% common.species[["bgd"]], species.code, 0))
helper.files[["bgd"]][["env"]] <- read_delim("../project2ndStudy/projectTest_bgd/gis/environment.txt")
helper.files[["grte"]][["ru"]] <- rast("../project2ndStudy/projectTest_grte/gis/landscape_env_grid.txt")
helper.files[["grte"]][["stand"]] <- rast("../project2ndStudy/projectTest_grte/gis/landscape_stand_grid.txt")
helper.files[["grte"]][["elev"]] <- rast("../project2ndStudy/projectTest_grte/gis/landscape_DEM.txt") %>%
resample(., helper.files[["grte"]][["ru"]])
helper.files[["grte"]][["species"]] <- dbConnect(RSQLite::SQLite(),  dbname = "../project2ndStudy/projectTest_grte/database/species_grte.sqlite") %>%
tbl(., "species") %>% collect() %>% dplyr::select(shortName, lightResponseClass, isConiferous, sapHDSapling, psiMin, displayColor) %>%
rename(species = shortName) %>% mutate(lightResponseClass = as.numeric(lightResponseClass)) %>%
mutate(species.code = as.numeric(as.factor(species))) %>%
filter(species %ni% c("Potr_backup", "Pial_backup_org", "Pico_backup")) %>%
mutate(species.code = ifelse(species %in% common.species$grte, species.code, 0))
helper.files[["grte"]][["env"]] <- read_delim("../project2ndStudy/projectTest_grte/gis/environment_file_cluster_kbdi_downscaledclimate.txt")
helper.files[["stoko"]][["ru"]] <- rast("../project2ndStudy/projectTest_stoko/gis/resourceUnit_snp_220908.asc")
helper.files[["stoko"]][["stand"]] <- rast("../project2ndStudy/projectTest_stoko/gis/standgrid_speed.asc")
helper.files[["stoko"]][["elev"]] <- rast("../project2ndStudy/projectTest_stoko/gis/jpn_elv_clipClim_JGD2000Zone13_res100m_cropped.asc") %>%
resample(., helper.files[["stoko"]][["ru"]])
helper.files[["stoko"]][["species"]] <- dbConnect(RSQLite::SQLite(),  dbname = "../project2ndStudy/projectTest_stoko/database/species_stoko.sqlite") %>%
tbl(., "speciesParameters") %>% collect() %>% dplyr::select(shortName, lightResponseClass, isConiferous, sapHDSapling, psiMin, displayColor) %>%
rename(species = shortName) %>% mutate(lightResponseClass = as.numeric(lightResponseClass)) %>%
mutate(species.code = as.numeric(as.factor(species))) %>%
mutate(species.code = ifelse(species %in% common.species$stoko, species.code, 0))
helper.files[["stoko"]][["env"]] <- read_delim("../project2ndStudy/projectTest_stoko/gis/environment_final.txt")
rid.df <- data.frame()
for (landscape in 1:3) {
rid_i <- helper.files[[landscapes[landscape]]][["ru"]] %>%
terra::as.data.frame(., xy=T) %>% rename(rid=3) %>%
drop_na() %>% mutate(landscape = landscapes[landscape])
if (landscape == 3) rid_i <- rid_i %>% filter(rid %in% keep.stoko)
rid.df <- bind_rows(rid.df, rid_i);rm(rid_i)
}; rm(keep.stoko)
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# discarded
# reorg.ls<-readRDS("raw_data/helper_files/reorg.ls.RDATA")
# keep <- reorg.ls[["stoko"]] %>% summarise(unique=unique(rid)) %>% pull(unique)
# write_csv(as.data.frame(keep), "raw_data/helper_files/keep.csv")
# Response line plots ####
overtime.ls <- readRDS("results/datasets/overtime.ls.RDATA")
patches <- bind_rows(readRDS("results/datasets/patch_bgd_backup.RDATA"),
readRDS("results/datasets/patch_grte_backup.RDATA"),
readRDS("results/datasets/patch_stoko_backup.RDATA"))
patchlist <- bind_rows(readRDS("results/datasets/patchlist_bgd.RDATA"),
readRDS("results/datasets/patchlist_grte.RDATA"),
readRDS("results/datasets/patchlist_stoko.RDATA"))
forest.ha.df <- patches %>%
inner_join(patchlist) %>%
inner_join(areas)
forest.ha.df %>%
filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 100, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor(c(1:80)/10))*10)) %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
forest.ha.df %>%
filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 100, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor(c(1:80)/10))*10)) %>% summary()
forest.ha.df %>%
filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 100, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor(c(1:80)/10))*10)) %>%
drop_na() %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
forest.ha.df %>%
# filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 100, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor(c(1:80)/10))*10)) %>%
drop_na() %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
forest.ha.df %>%
# filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(year, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 100, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor(c(1:80)/10))*10)) %>%
drop_na() %>%
ggplot(aes(x=year, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
forest.ha.df %>%
# filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 100, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor((c(1:80)-1)/10))*10)) %>%
#drop_na() %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
forest.ha.df %>%
# filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 100, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor((c(1:80)-1)/10))*10+10)) %>%
#drop_na() %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
forest.ha.df %>%
# filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
mutate(forest.ha = ifelse(n_patches < 10, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor((c(1:80)-1)/10))*10+10)) %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# Set up ###########################################################################################################################################
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
library(tidyverse)
library(ggpubr)
library(RSQLite); library(dbplyr)
library(terra)
library(beepr)
"%ni%" <- Negate("%in%")
options(dplyr.summarise.inform = FALSE, readr.show_col_types = FALSE)
#setwd(dirname(rstudioapi::getActiveDocumentContext()$path)); getwd() # set wd to file location
landscapes <- c("bgd", "grte", "stoko")
vars <- c("size", "freq", "fecundity", "browsing")
keep.stoko <- read_csv("raw_data/helper_files/keep.csv") %>% pull(keep)
areas <- data.frame(area = c(8645, 42586, 35676), landscape=landscapes) # forested landscape area in ha, "bgd", "grte", "stoko"
response.colors <- c("#1b9e77", "#7570b3", "#d95f02"); names(response.colors) <- c('1. Structure\nBasal area decreased by >50 % from reference',  '2. Composition\nDominant species changed from reference', '3. Remaining forest\nStem density dropping below 50 trees/ha')
colors.landscape <- c("#009988", "#999933", "#882255")
names(colors.landscape) <- c("Berchtesgaden", "Grand Teton", "Shiretoko")
# areas <- c(8645, 42586, 35676) # same order as landscapes
#
# set up ####
# Most common species ###
# (common.bgd <- dbConnect(RSQLite::SQLite(), "raw_data/breakingTheSystem_BGD_Results/data1/output.sqlite") %>%
#    tbl(., "landscape") %>% collect() %>%
#    group_by(species) %>% summarise(a=mean(basal_area_m2)) %>% arrange(desc(a)) %>% slice(1:8) %>% pull(species))
common.bgd <- c("piab", "lade", "fasy", "pice", "abal", "acps", "frex", "soau")
# (common.grte <- dbConnect(RSQLite::SQLite(), "raw_data/breakingTheSystem_GRTE_Results/data1/output.sqlite") %>%
#     tbl(., "landscape") %>% collect() %>%
#     group_by(species) %>% summarise(a=mean(basal_area_m2)) %>% arrange(desc(a)) %>% slice(1:8) %>% pull(species))
common.grte <- c("Pico", "Psme", "PicS", "Pien", "Potr", "Abla", "Pial")
# (common.stoko <- dbConnect(RSQLite::SQLite(), "raw_data/breakingTheSystem_STOKO_Results/data1/output.sqlite") %>%
#     tbl(., "landscape") %>% collect() %>%
#     group_by(species) %>% summarise(a=mean(basal_area_m2)) %>% arrange(desc(a)) %>% slice(1:8) %>%
#     pull(species))
common.stoko <- c("beer", "absa", "acmo", "kase", "qumo", "alhi", "tacu", "soco")
common.species <- list(common.bgd, common.grte, common.stoko); names(common.species) <- landscapes; rm(common.bgd, common.grte, common.stoko)
helpers <- list(list(), list(), list(), tibble(), tibble()); names(helpers) <- c("ru", "stand", "elev", "species", "env")
helper.files <- list(helpers, helpers, helpers); names(helper.files) <- landscapes; rm(helpers)
helper.files[["bgd"]][["ru"]] <- rast("../project2ndStudy/projectTest_bgd/gis/objectid.asc")
helper.files[["bgd"]][["stand"]] <- rast("../project2ndStudy/projectTest_bgd/gis/standgrid.asc")
helper.files[["bgd"]][["elev"]] <- rast("../project2ndStudy/projectTest_bgd/gis/dem100_rid.asc") %>%
resample(., helper.files[["bgd"]][["ru"]])
helper.files[["bgd"]][["species"]] <- dbConnect(RSQLite::SQLite(),  dbname = "../project2ndStudy/projectTest_bgd/database/species_bgd.sqlite") %>%
tbl(., "species") %>% collect() %>% dplyr::select(shortName, lightResponseClass, isConiferous, sapHDSapling, psiMin, displayColor) %>%
rename(species = shortName) %>% mutate(lightResponseClass = as.numeric(lightResponseClass)) %>%
mutate(species.code = as.numeric(as.factor(species))) %>%
mutate(species.code = ifelse(species %in% common.species[["bgd"]], species.code, 0))
helper.files[["bgd"]][["env"]] <- read_delim("../project2ndStudy/projectTest_bgd/gis/environment.txt")
helper.files[["grte"]][["ru"]] <- rast("../project2ndStudy/projectTest_grte/gis/landscape_env_grid.txt")
helper.files[["grte"]][["stand"]] <- rast("../project2ndStudy/projectTest_grte/gis/landscape_stand_grid.txt")
helper.files[["grte"]][["elev"]] <- rast("../project2ndStudy/projectTest_grte/gis/landscape_DEM.txt") %>%
resample(., helper.files[["grte"]][["ru"]])
helper.files[["grte"]][["species"]] <- dbConnect(RSQLite::SQLite(),  dbname = "../project2ndStudy/projectTest_grte/database/species_grte.sqlite") %>%
tbl(., "species") %>% collect() %>% dplyr::select(shortName, lightResponseClass, isConiferous, sapHDSapling, psiMin, displayColor) %>%
rename(species = shortName) %>% mutate(lightResponseClass = as.numeric(lightResponseClass)) %>%
mutate(species.code = as.numeric(as.factor(species))) %>%
filter(species %ni% c("Potr_backup", "Pial_backup_org", "Pico_backup")) %>%
mutate(species.code = ifelse(species %in% common.species$grte, species.code, 0))
helper.files[["grte"]][["env"]] <- read_delim("../project2ndStudy/projectTest_grte/gis/environment_file_cluster_kbdi_downscaledclimate.txt")
helper.files[["stoko"]][["ru"]] <- rast("../project2ndStudy/projectTest_stoko/gis/resourceUnit_snp_220908.asc")
helper.files[["stoko"]][["stand"]] <- rast("../project2ndStudy/projectTest_stoko/gis/standgrid_speed.asc")
helper.files[["stoko"]][["elev"]] <- rast("../project2ndStudy/projectTest_stoko/gis/jpn_elv_clipClim_JGD2000Zone13_res100m_cropped.asc") %>%
resample(., helper.files[["stoko"]][["ru"]])
helper.files[["stoko"]][["species"]] <- dbConnect(RSQLite::SQLite(),  dbname = "../project2ndStudy/projectTest_stoko/database/species_stoko.sqlite") %>%
tbl(., "speciesParameters") %>% collect() %>% dplyr::select(shortName, lightResponseClass, isConiferous, sapHDSapling, psiMin, displayColor) %>%
rename(species = shortName) %>% mutate(lightResponseClass = as.numeric(lightResponseClass)) %>%
mutate(species.code = as.numeric(as.factor(species))) %>%
mutate(species.code = ifelse(species %in% common.species$stoko, species.code, 0))
helper.files[["stoko"]][["env"]] <- read_delim("../project2ndStudy/projectTest_stoko/gis/environment_final.txt")
rid.df <- data.frame()
for (landscape in 1:3) {
rid_i <- helper.files[[landscapes[landscape]]][["ru"]] %>%
terra::as.data.frame(., xy=T) %>% rename(rid=3) %>%
drop_na() %>% mutate(landscape = landscapes[landscape])
if (landscape == 3) rid_i <- rid_i %>% filter(rid %in% keep.stoko)
rid.df <- bind_rows(rid.df, rid_i);rm(rid_i)
}; rm(keep.stoko)
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# discarded
# reorg.ls<-readRDS("raw_data/helper_files/reorg.ls.RDATA")
# keep <- reorg.ls[["stoko"]] %>% summarise(unique=unique(rid)) %>% pull(unique)
# write_csv(as.data.frame(keep), "raw_data/helper_files/keep.csv")
# Response line plots ####
overtime.ls <- readRDS("results/datasets/overtime.ls.RDATA")
patches <- bind_rows(readRDS("results/datasets/patch_bgd_backup.RDATA"),
readRDS("results/datasets/patch_grte_backup.RDATA"),
readRDS("results/datasets/patch_stoko_backup.RDATA"))
patchlist <- bind_rows(readRDS("results/datasets/patchlist_bgd.RDATA"),
readRDS("results/datasets/patchlist_grte.RDATA"),
readRDS("results/datasets/patchlist_stoko.RDATA"))
forest.ha.df <- patches %>%
inner_join(patchlist) %>%
inner_join(areas)
View(overtime.ls)
bind_rows(overtimels[["bgd"]],overtimels[["grte"]],overtimels[["stoko"]])
bind_rows(overtime.ls[["bgd"]],overtime.ls[["grte"]],overtime.ls[["stoko"]])
bind_rows(overtime.ls[["bgd"]],overtime.ls[["grte"]],overtime.ls[["stoko"]]) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
# geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
bind_rows(overtime.ls[["bgd"]],overtime.ls[["grte"]],overtime.ls[["stoko"]]) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
# geom_line(linewidth=0.2, alpha=0.2) +
# geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
bind_rows(overtime.ls[["grte"]],overtime.ls[["stoko"]]) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
# geom_line(linewidth=0.2, alpha=0.2) +
# geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
bind_rows(overtime.ls[["stoko"]]) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
# geom_line(linewidth=0.2, alpha=0.2) +
# geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
bind_rows(overtime.ls[["stoko"]], overtime.ls[["bgd"]]) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
# geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
overtime.ls[["grte"]] %>% summary()
overtime.ls[["grte"]] %>% filter(is.na('1. Structure\nBasal area decreased by >50 % from reference'))
overtime.ls[["grte"]] %>% filter(is.na('2. Composition\nDominant species changed from reference'))
overtime.ls[["grte"]] %>% pull('2. Composition\nDominant species changed from reference')
a<-overtime.ls[["grte"]] %>% pull('2. Composition\nDominant species changed from reference')
summary(a)
a[is.na(a)]
is.na(a)
a<-overtime.ls[["grte"]]
View(a)
a[-7681,]
a[-7681,] %>% summary()
a[c(-7681, -7682),] %>% summary()
a<-a[c(-7681, -7682),]
bind_rows(overtime.ls[["stoko"]], overtime.ls[["bgd"]], a) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
# geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
View(a)
overtime.ls[["grte"]]<-overtime.ls[["grte"]][c(-7681, -7682),]
View(overtime.ls)
bind_rows(overtime.ls[["stoko"]], overtime.ls[["bgd"]], overtime.ls[["grte"]]) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
# geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
saveRDS(overtime.ls, "results/datasets/overTime.ls.RDATA")
bind_rows(overtime.ls[["stoko"]], overtime.ls[["bgd"]], overtime.ls[["grte"]]) %>%
full_join(areas)
bind_rows(overtime.ls[["stoko"]], overtime.ls[["bgd"]], overtime.ls[["grte"]]) %>%
full_join(areas) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`*area,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
bind_rows(overtime.ls[["stoko"]], overtime.ls[["bgd"]], overtime.ls[["grte"]]) %>%
full_join(areas) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`*area,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape) +
theme_bw()
forest.ha.df %>%
# filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 10, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor((c(1:80)-1)/10))*10+10)) %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape) +
theme_bw()
bind_rows(overtime.ls[["stoko"]], overtime.ls[["bgd"]], overtime.ls[["grte"]]) %>%
full_join(areas) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`*area,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape) +
labs(x="Forested area") +
theme_bw()
bind_rows(overtime.ls[["stoko"]], overtime.ls[["bgd"]], overtime.ls[["grte"]]) %>%
full_join(areas) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`*area,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape) +
labs(y="Forested area") +
theme_bw()
bind_rows(overtime.ls[["stoko"]], overtime.ls[["bgd"]], overtime.ls[["grte"]]) %>%
full_join(areas) %>%
ggplot(aes(x=year, y=`3. Remaining forest\nStem density dropping below 50 trees/ha`*area,
group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
labs(y="Forested area") +
theme_bw()
forest.ha.df %>%
# filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
# calculate weighted.mean -> bigger patches should be more reliable
summarise(forest.ha=weighted.mean(pct, n_cells)*mean(area), area=mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 10, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor((c(1:80)-1)/10))*10+10)) %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape) +
theme_bw()
forest.ha.df %>%
# filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
summarise(area=mean(area),
forest.ha=mean(pct)*mean(area),
# calculate weighted.mean -> bigger patches should be more reliable
# forest.ha=weighted.mean(pct, n_cells)*mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 10, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor((c(1:80)-1)/10))*10+10)) %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape) +
theme_bw()
forest.ha.df %>%
# filter(agent %in% c("wind", "fire")) %>% # only unspecific agents
mutate(decade = (floor((year-1)/10))*10+10) %>%
mutate(pct=n_cells/n_cells_soll) %>%
group_by(decade, landscape, climate, size, freq, browsing, fecundity, rep) %>%
summarise(area=mean(area),
forest.ha=mean(pct)*mean(area),
# calculate weighted.mean -> bigger patches should be more reliable
# forest.ha=weighted.mean(pct, n_cells)*mean(area),
n_patches = length(unique(patchID))) %>% ungroup() %>%
# shiretoko: set to full area if only few patches occurred that year
# mutate(forest.ha = ifelse(n_patches < 10, area, forest.ha)) %>% ungroup() %>%
mutate(size = factor(size, levels = rev(c("10", "5", "2", "1"))),
freq = factor(freq, levels = rev(c("10", "5", "2", "1"))),
fecundity = factor(fecundity, levels = c("100", "50", "20", "10")),
browsing = factor(browsing, levels = rev(c("10", "5", "2", "1")))) %>%
full_join(data.frame(year = 1:80, decade = (floor((c(1:80)-1)/10))*10+10)) %>%
ggplot(aes(x=decade, y=forest.ha, group=paste(climate, size, freq, browsing, fecundity,rep))) +
geom_line(linewidth=0.2, alpha=0.2) +
geom_hline(aes(yintercept=area), col="red") +
facet_wrap(~landscape, scales="free_y") +
theme_bw()
